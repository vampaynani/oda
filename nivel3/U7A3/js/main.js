// Generated by CoffeeScript 1.6.3
(function() {
  var U6A3,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  U6A3 = (function(_super) {
    __extends(U6A3, _super);

    function U6A3() {
      this.nextEvaluation = __bind(this.nextEvaluation, this);
      this.clearEvaluation = __bind(this.clearEvaluation, this);
      this.finishEvaluation = __bind(this.finishEvaluation, this);
      this.evaluateAnswer = __bind(this.evaluateAnswer, this);
      this.initEvaluation = __bind(this.initEvaluation, this);
      var manifest, sounds;
      manifest = [
        {
          id: 'head',
          src: 'pleca1.png'
        }, {
          id: 'inst',
          src: 'inst.png'
        }, {
          id: 'c1',
          src: 'circle1.png'
        }, {
          id: 'c2',
          src: 'circle2.png'
        }, {
          id: 'btnrepeat',
          src: 'btn_repeat.png'
        }, {
          id: 'camelrap0001',
          src: 'camelrap0001.png'
        }, {
          id: 'propnota',
          src: 'prop_nota.png'
        }, {
          id: 'fondonaranja',
          src: 'fondo-naranja.png'
        }, {
          id: 'fondoverde',
          src: 'fondo-verde.png'
        }, {
          id: 'fondo',
          src: 'fondo.png'
        }, {
          id: 'howget1',
          src: 'how_get0001.png'
        }, {
          id: 'howget2',
          src: 'how_get0002.png'
        }, {
          id: 'howgetdrag',
          src: 'how_get_drag.png'
        }, {
          id: 'whatbring1',
          src: 'what_bring0001.png'
        }, {
          id: 'whatbring2',
          src: 'what_bring0002.png'
        }, {
          id: 'whatbringdrag',
          src: 'what_bring_drag.png'
        }, {
          id: 'whattrade1',
          src: 'what_trade0001.png'
        }, {
          id: 'whattrade2',
          src: 'what_trade0002.png'
        }, {
          id: 'whattradedrag',
          src: 'what_trade_drag.png'
        }, {
          id: 'wherego1',
          src: 'where_go0001.png'
        }, {
          id: 'wherego2',
          src: 'where_go0002.png'
        }, {
          id: 'wheregodrag',
          src: 'where_go_drag.png'
        }
      ];
      sounds = [
        {
          src: 'sounds/boing.mp3',
          id: 'boing'
        }, {
          src: 'sounds/good.mp3',
          id: 'good'
        }, {
          src: 'sounds/wrong.mp3',
          id: 'wrong'
        }, {
          src: 'sounds/TU3_U7_A3_Instructions.mp3',
          id: 'instructions'
        }
      ];
      this.game = {
        btns: [],
        steps: [
          {
            targets: ['how', 'did', 'you', 'get', 'there'],
            drags: [
              {
                i: 1,
                t: 'how',
                x: 145,
                y: 52
              }, {
                i: 2,
                t: 'did',
                x: 119,
                y: 17
              }, {
                i: 3,
                t: 'you',
                x: 25,
                y: 55
              }, {
                i: 4,
                t: 'get',
                x: 84,
                y: 52
              }, {
                i: 5,
                t: 'there',
                x: 48,
                y: 15
              }
            ],
            drop: [
              {
                img: 'fondoverde',
                x: 121,
                y: 153
              }
            ]
          }, {
            targets: ['what', 'did', 'you', 'bring'],
            drags: [
              {
                i: 6,
                t: 'what',
                x: 111,
                y: 19
              }, {
                i: 7,
                t: 'did',
                x: 36,
                y: 16
              }, {
                i: 8,
                t: 'you',
                x: 134,
                y: 56
              }, {
                i: 9,
                t: 'bring',
                x: 36,
                y: 57
              }
            ],
            drop: [
              {
                img: 'fondonaranja',
                x: 532,
                y: 153
              }
            ]
          }, {
            targets: ['what', 'did', 'you', 'trade'],
            drags: [
              {
                i: 10,
                t: 'what',
                x: 120,
                y: 20
              }, {
                i: 11,
                t: 'did',
                x: 49,
                y: 56
              }, {
                i: 12,
                t: 'you',
                x: 116,
                y: 60
              }, {
                i: 13,
                t: 'trade',
                x: 37,
                y: 20
              }
            ],
            drop: [
              {
                img: 'fondonaranja',
                x: 121,
                y: 346
              }
            ]
          }, {
            targets: ['where', 'did', 'you', 'go'],
            drags: [
              {
                i: 14,
                t: 'where',
                x: 119,
                y: 48
              }, {
                i: 15,
                t: 'did',
                x: 39,
                y: 50
              }, {
                i: 16,
                t: 'you',
                x: 31,
                y: 21
              }, {
                i: 17,
                t: 'go',
                x: 127,
                y: 20
              }
            ],
            drop: [
              {
                img: 'fondoverde',
                x: 532,
                y: 346
              }
            ]
          }
        ]
      };
      U6A3.__super__.constructor.call(this, null, manifest, sounds);
    }

    U6A3.prototype.setStage = function() {
      var step, stepsimg;
      U6A3.__super__.setStage.apply(this, arguments);
      this.steps = this.game.steps;
      this.intento = 0;
      stepsimg = (function() {
        var _i, _len, _ref, _results;
        _ref = this.steps;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          step = _ref[_i];
          _results.push(step.img);
        }
        return _results;
      }).call(this);
      this.insertBitmap('header', 'head', stageSize.w / 2, 0, 'tc');
      this.insertInstructions('instructions', 'Put the questions in the correct order.', 40, 100);
      this.insertBitmap('fondo', 'fondo', stageSize.w / 2 + 15, 60, 'tc');
      this.addToMain(new Score('score', this.preload.getResult('c1'), this.preload.getResult('c2'), 20, 500, 8, 0));
      return this.setDropper(1).setDropper(2).setDropper(3).setDropper(4);
    };

    U6A3.prototype.setDropper = function(step) {
      var back, d, dropper, h, i, opt, question, _i, _j, _len, _ref, _ref1;
      this.step = step;
      dropper = new createjs.Container();
      dropper.y = this.steps[step - 1].drop[0].y;
      dropper.x = this.steps[step - 1].drop[0].x;
      dropper.name = 'dropper';
      this.addToMain(dropper);
      back = this.createBitmap('back', this.steps[step - 1].drop[0].img, 0, 0);
      dropper.addChild(back);
      _ref = this.steps[step - 1].drags;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        opt = _ref[_i];
        d = new DroppableText("n1d" + opt.i, opt.t, opt.t, opt.x, opt.y, this.stage);
        d.text.color = '#ffffff';
        dropper.addChild(d);
        this.addToLibrary(d);
      }
      for (i = _j = 0, _ref1 = this.steps[step - 1].targets.length - 1; _j <= _ref1; i = _j += 1) {
        h = new WordContainer("h" + i, '', '#FFF', '#2393D6', (62 * i) - 24, 100, 58, 22);
        h.index = i;
        dropper.addChild(h);
        this.addToLibrary(h);
      }
      question = this.createText('q', '?', '24px Quicksand', '#333', this.steps[step - 1].targets.length * 62 - 24, 100);
      dropper.addChild(question);
      return this;
    };

    U6A3.prototype.setCamel = function() {
      var btn, btn1, btn2, btn3, btn4, camel, camello, nota, sp1, sp2, sp3, sp4;
      camel = new createjs.Container();
      camel.x = 0;
      camel.y = 0;
      camel.name = 'camel';
      btn1 = this.createBitmap('wheregodrag', 'wheregodrag', 478, 444);
      btn2 = this.createBitmap('whattradedrag', 'whattradedrag', 125, 444);
      btn3 = this.createBitmap('whatbringdrag', 'whatbringdrag', 132, 500);
      btn4 = this.createBitmap('howgetdrag', 'howgetdrag', 475, 500);
      sp1 = this.createSprite('sp1', ['wherego1', 'wherego2'], null, 34, 163);
      sp2 = this.createSprite('sp2', ['whattrade1', 'whattrade2'], null, 515, 259);
      sp3 = this.createSprite('sp3', ['whatbring1', 'whatbring2'], null, 515, 163);
      sp4 = this.createSprite('sp4', ['howget1', 'howget2'], null, 34, 259);
      nota = this.createBitmap('propnota', 'propnota', 381, 398);
      camello = this.createBitmap('camelrap0001', 'camelrap0001', 293, 140);
      btn = this.createBitmap('btnrepeat', 'btnrepeat', 350, 346);
      camel.addChild(nota, camello, btn);
      camel.addChild(btn1, btn2, btn3, btn4);
      camel.addChild(sp1, sp2, sp3, sp4);
      this.addToMain(camel);
      return this;
    };

    U6A3.prototype.setNube1 = function() {
      var container, d, opt, _i, _len, _ref;
      container = new createjs.Container();
      container.x = 150;
      container.y = this.library.dropper.y + 200;
      container.name = 'nube1';
      _ref = this.game.opt1;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        opt = _ref[_i];
        d = new DroppableText("n1d" + opt.i, opt.t, opt.t, opt.x, opt.y, this.stage);
        container.addChild(d);
        this.addToLibrary(d);
      }
      this.addToMain(container);
      return this;
    };

    U6A3.prototype.setNube2 = function() {
      var container, d, opt, _i, _len, _ref;
      container = new createjs.Container();
      container.x = 250;
      container.y = this.library.dropper.y + 200;
      container.name = 'nube2';
      _ref = this.game.opt2;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        opt = _ref[_i];
        d = new DroppableText("n2d" + opt.i, opt.t, opt.t, opt.x, opt.y, this.stage);
        container.addChild(d);
        this.addToLibrary(d);
      }
      this.addToMain(container);
      return this;
    };

    U6A3.prototype.introEvaluation = function() {
      U6A3.__super__.introEvaluation.apply(this, arguments);
      TweenLite.from(this.library.header, 1, {
        y: -this.library.header.height
      });
      TweenLite.from(this.library.instructions, 1, {
        alpha: 0,
        x: 0,
        delay: 0.5
      });
      return TweenLite.from(this.library.dropper, 1, {
        alpha: 0,
        y: this.library.dropper.y + 20,
        delay: 0.7
      });
    };

    U6A3.prototype.initEvaluation = function(e) {
      var opt, _i, _j, _len, _len1, _ref, _ref1, _results;
      U6A3.__super__.initEvaluation.apply(this, arguments);
      _ref = this.game.opt1;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        opt = _ref[_i];
        this.library["n1d" + opt.i].updateDrops(this.library.h0);
        this.library["n1d" + opt.i].addEventListener('dropped', this.evaluateAnswer);
        this.library["n1d" + opt.i].initDragListener();
      }
      _ref1 = this.game.opt2;
      _results = [];
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        opt = _ref1[_j];
        if (this.steps[this.step - 1].targets.length === 3) {
          this.library["n2d" + opt.i].updateDrops(this.library.h1, this.library.h2);
        } else {
          this.library["n2d" + opt.i].updateDrops(this.library.h1);
        }
        this.library["n2d" + opt.i].addEventListener('dropped', this.evaluateAnswer);
        _results.push(this.library["n2d" + opt.i].initDragListener());
      }
      return _results;
    };

    U6A3.prototype.evaluateAnswer = function(e) {
      this.answer = e.target;
      this.drop = e.drop;
      if (this.answer.index === this.steps[this.step - 1].targets[this.drop.index]) {
        this.answer.visible = false;
        this.drop.changeText(this.answer.index);
        createjs.Sound.play('good');
        return this.finishEvaluation();
      } else {
        this.warning();
        this.intento++;
        console.log(this.intento);
        this.answer.returnToPlace();
        if (this.intento === 2) {
          this.intento = 0;
          return this.clearEvaluation();
        }
      }
    };

    U6A3.prototype.finishEvaluation = function() {
      if (this.steps[this.step - 1].targets.length === 3) {
        if (this.library.h0.text.text === '' || this.library.h1.text.text === '' || this.library.h2.text.text === '') {
          return;
        }
      } else {
        if (this.library.h0.text.text === '' || this.library.h1.text.text === '') {
          return;
        }
      }
      this.library['score'].plusOne();
      this.intento = 0;
      return setTimeout(this.clearEvaluation, 1 * 1000);
    };

    U6A3.prototype.clearEvaluation = function(e) {
      var opt, _i, _j, _len, _len1, _ref, _ref1;
      _ref = this.game.opt1;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        opt = _ref[_i];
        this.library["n1d" + opt.i].visible = true;
        this.library["n1d" + opt.i].returnToPlace();
      }
      _ref1 = this.game.opt2;
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        opt = _ref1[_j];
        this.library["n2d" + opt.i].visible = true;
        this.library["n2d" + opt.i].returnToPlace();
      }
      return TweenLite.to(this.library.dropper, 0.5, {
        alpha: 0,
        y: this.library.dropper.y + 20
      });
    };

    U6A3.prototype.nextEvaluation = function() {
      var opt, _i, _j, _len, _len1, _ref, _ref1, _results;
      this.index++;
      if (this.index < this.steps.length) {
        this.setDropper(this.index + 1);
        TweenLite.to(this.library.dropper, 0.5, {
          alpha: 1
        });
        _ref = this.game.opt1;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          opt = _ref[_i];
          this.library["n1d" + opt.i].updateDrops(this.library.h0);
        }
        _ref1 = this.game.opt2;
        _results = [];
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          opt = _ref1[_j];
          if (this.steps[this.step - 1].targets.length === 3) {
            _results.push(this.library["n2d" + opt.i].updateDrops(this.library.h1, this.library.h2));
          } else {
            _results.push(this.library["n2d" + opt.i].updateDrops(this.library.h1));
          }
        }
        return _results;
      } else {
        return this.finish();
      }
    };

    U6A3.prototype.finish = function() {
      TweenLite.to(this.library.nube1, 1, {
        alpha: 0,
        y: this.library.nube1.y + 20
      });
      TweenLite.to(this.library.nube2, 1, {
        alpha: 0,
        y: this.library.nube2.y + 20
      });
      return U6A3.__super__.finish.apply(this, arguments);
    };

    window.U6A3 = U6A3;

    return U6A3;

  })(Oda);

}).call(this);
